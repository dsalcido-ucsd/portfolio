<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project 3 - Data Visualization with Maps</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body class="project-page project3-page">
    <p class="breadcrumb"><a href="index.html">← Back to Projects</a></p>

    <main>
        <h1>Peak &amp; Pace: How countries age before and after population peak</h1>
        <p class="subhead">Explore when each country reaches (or doesn't reach) its population peak and how quickly the old-age burden rises afterward.</p>
        
        <section>
            <h2>Introduction</h2>
            <p>This interactive uses United Nations WPP 2024 projections (1950–2100) to show when countries peak in total population and how fast they age after that point. Select countries on the map to compare their old-age dependency ratio (OADR), older adults (65+) per 100 working-age people (15–64), at the peak year versus N years later. A components view breaks growth into natural increase (births − deaths) and net migration by decade.</p>
        </section>

        <section>
            <div class="full-bleed">
              <div class="viz-wrap">
                                    <!-- Map + Controls in flexible layout -->
                                    <div class="viz-grid">
                                        <!-- Main map area -->
                                        <div class="map-container">
                                            <svg id="map" width="1100" height="520" role="img" aria-label="World map"></svg>
                                            <div class="chart-guide" style="margin-top: 1rem; padding: 1rem; border-left: 3px solid rgba(100,100,100,0.3);">
                                                <h4 style="margin-top: 0;">How to use</h4>
                                                <p style="margin: 0.5rem 0;"><strong>Map:</strong> Click a country to select; Shift-click to compare up to 5.</p>
                                                <p style="margin: 0.5rem 0;"><strong>Slider:</strong> Change N (10–30) to see OADR at Peak + N.</p>
                                                <p style="margin: 0.5rem 0;"><strong>Decade &amp; Mode:</strong> Choose a decade and toggle Absolute vs Per-1k to view components of change.</p>
                                                <p style="margin: 0.5rem 0;"><strong>Search &amp; Clear:</strong> Use the search box to jump to a country; Clear selection to reset.</p>
                                                
                                                <h4 style="margin-top: 1.5rem;">Colors on the map</h4>
                                                <p style="margin: 0.5rem 0;"><strong>Peaked:</strong> peak occurred before 2025.</p>
                                                <p style="margin: 0.5rem 0;"><strong>2050:</strong> peak projected 2025–2054.</p>
                                                <p style="margin: 0.5rem 0;"><strong>2055+:</strong> peak projected 2055 or later.</p>
                                                <p style="margin: 0.5rem 0;"><strong>No peak (by 2100):</strong> total population never turns downward within 1950–2100.</p>
                                            </div>
                                        </div>
                  
                                        <!-- Control panel (legend, slider, search) -->
                                        <aside class="control-panel">
                                            <div class="control-section">
                                                <h3>Filter by peak status</h3>
                                                <div id="legend" class="legend" aria-label="Peak status legend"></div>
                                            </div>
                    
                                            <div class="control-section">
                                                <h3>Years after peak</h3>
                                                <div class="years-control">
                                                    <div class="slider-display">
                                                        <label for="yearsAfter">N = <span id="yearsAfterValue">25</span> years</label>
                                                    </div>
                                                    <input id="yearsAfter" type="range" min="10" max="30" step="5" value="25" />
                                                </div>
                                            </div>
                    
                                            <div class="control-section">
                                                <h3>Country search</h3>
                                                <div class="search-controls">
                                                    <input id="countrySearch" type="text" placeholder="Type country name..." />
                                                    <button id="clearSelection">Clear Selection</button>
                                                </div>
                                            </div>
                                            
                                            <div class="control-section">
                                                <h3>Selection summary</h3>
                                                <div id="summary" class="summary-card">
                                                    <div class="summary-placeholder">Select a country to see details</div>
                                                </div>
                                            </div>
                                        </aside>
                                    </div>

                                    <!-- OADR slopegraph and Components side-by-side -->
                                    <div class="charts-grid">
                                        <div class="chart-panel">
                                            <h3>Old-Age Dependency Ratio (OADR)</h3>
                                            <div id="oadrChart"></div>
                                            <div class="chart-guide" style="margin-top: 1rem; padding: 1rem; border-left: 3px solid rgba(100,100,100,0.3);">
                                                <h4 style="margin-top: 0;">How to read</h4>
                                                <p style="margin: 0.5rem 0;">Y-axis = older adults per 100 working-age. Higher ⇒ heavier aging burden.</p>
                                                <p style="margin: 0.5rem 0;">Upward line ⇒ faster aging after peak, flat may indicate limited change or a no-peak-by-2100 case (both columns use 2100).</p>
                                                <p style="margin: 0.5rem 0; font-style: italic;">Callout: "Japan peaked in 2008, OADR climbs quickly thereafter."</p>
                                            </div>
                                        </div>
                  
                                        <div class="chart-panel">
                                            <h3>Components of Change</h3>
                                            <div id="controls"></div>
                                            <div id="componentsChart"></div>
                                            <div class="chart-guide" style="margin-top: 1rem; padding: 1rem; border-left: 3px solid rgba(100,100,100,0.3);">
                                                <h4 style="margin-top: 0;">How to read</h4>
                                                <p style="margin: 0.5rem 0;">Shows <strong>Births</strong> (+), <strong>Deaths</strong> (−), and <strong>Net migration</strong> (±) for the selected decade.</p>
                                                <p style="margin: 0.5rem 0;">Total change = (Births − Deaths) + Net migration.</p>
                                                <p style="margin: 0.5rem 0;">Switch to Per-1k to compare countries of different sizes.</p>
                                                <p style="margin: 0.5rem 0; font-style: italic;">Callout: "United States shows negative natural increase in later decades but remains positive overall due to migration."</p>
                                                <p style="margin: 0.5rem 0; font-style: italic;">Callout: "Many Sub-Saharan countries remain 'no peak by 2100' due to sustained natural increase."</p>
                                            </div>
                                        </div>
                                    </div>
              </div>
            </div>
        </section>

        <section>
            <h2>Data &amp; methods</h2>
            <p><strong>Sources:</strong> UN World Population Prospects 2024, Standard Projections, Medium variant.</p>
            <ul>
                <li>Population by 5-year age groups (both sexes) → totals and OADR.</li>
                <li>Demographic indicators → births, deaths, net migration (decadal sums; per-1k are decade averages).</li>
            </ul>
            <p><strong>Definitions:</strong> OADR = Pop(65+) / Pop(15–64). "No peak" means no decline within the projection window—not "never."</p>
            <p><strong>Limits:</strong> Peak+N is capped at 2100; results reflect Medium-scenario assumptions about fertility, mortality, and migration.</p>
        </section>

        <section id="writeup" style="max-width:900px;margin:2rem 0 4rem;">
            <h2>Design Rationale</h2>
            <p><strong>Goal.</strong> Enable exploration of <em>when</em> countries reach peak population and <em>how fast</em> the old-age burden rises afterward—and explain <em>why</em> via births, deaths, and migration.</p>

            <p><strong>Views &amp; Encodings.</strong> A categorical world map shows four peak-timing buckets (peaked, 2050, 2055+, no peak by 2100) and acts as the dynamic filter. A two-column
            <em>slopegraph</em> compares the old-age dependency ratio (OADR: 65+ per 100 people aged 15–64) at the <em>peak year</em> versus <em>Peak + N</em> (slider). Lines are dashed for "no peak by 2100" so flat lines aren't misread. A <em>waterfall</em> explains mechanisms for a selected decade:
            births (+), deaths (−), net migration (±), and the resulting Δ population. A toggle switches between decade totals (Absolute; units match WPP) and average annual rates (Per 1k/yr) to normalize for country size.</p>

            <p><strong>Alternatives considered.</strong> Time-series small multiples and cartograms were tested but made scanning and search harder. Stacked areas tell trends but obscure add/subtract logic, so the waterfall was chosen for clarity.</p>

            <p><strong>Transformations.</strong> Peak year is the argmax of annual totals (WPP 2024, Medium). Countries are bucketed: &lt;2025 = peaked; 2025–2054 = 2050; ≥2055 = 2055+; maximum at 2100 = no peak (by 2100). OADR = Pop(65+)/Pop(15–64). Peak + N is capped at 2100. Components aggregate births, deaths, net migration by decade; Per 1k/yr uses decade-average (component/pop × 1000).</p>

            <h2>Development Process</h2>
            <p><strong>Stack.</strong> D3.js only on the client; data prepped with pandas; hosted via GitHub Pages (static CSVs).</p>

            <p><strong>Work split.</strong> All work completed by me</p>

            <ul>
                <li>Data acquisition &amp; cleaning (WPP 2024 Medium; country filtering): <em>[~3–5h]</em></li>
                <li>Deriving metrics (peak buckets, OADR, decade components; validation): <em>[~3–4h]</em></li>
                <li>D3 map + interactions (projection, coloring, search, legend filters): <em>[~4–6h]</em></li>
                <li>Slopegraph (selection, slider, tooltips, dashed no-peak): <em>[~3–4h]</em></li>
                <li>Components waterfall (absolute/per-1k toggle, decade control): <em>[~3–4h]</em></li>
                <li>Integration, layout, copy, QA: <em>[~2–3h]</em></li>
            </ul>

            <p><strong>Biggest challenges.</strong> Harmonizing WPP tables and handling edge cases (e.g., "no peak by 2100") and coordinating multi-view interactions (map ↔ slopegraph ↔ components).</p>

            <p><strong>Limits &amp; next steps.</strong> This deploy uses the Medium scenario only; adding Low/High fertility or Zero-migration toggles would show sensitivity. Small multiples for components across multi-selection are a natural extension.</p>
        </section>
    </main>

    <script type="module" src="../global.js"></script>
    <script type="module" src="project3.js"></script>
</body>
</html>
