<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project 3 - Data Visualization with Maps</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body class="project-page project3-page">
    <p class="breadcrumb"><a href="index.html">← Back to Projects</a></p>

    <main>
        <h1>Peak &amp; Pace: How countries age before and after population peak</h1>
        <p class="subhead">Explore when each country reaches (or doesn't reach) its population peak and how quickly the old-age burden rises afterward.</p>
        
        <section>
            <h2>Introduction</h2>
            <p>This interactive uses United Nations WPP 2024 projections (1950–2100) to show when countries peak in total population and how fast they age after that point. Select countries on the map to compare their old-age dependency ratio (OADR), older adults (65+) per 100 working-age people (15–64), at the peak year versus N years later. A components view breaks growth into natural increase (births − deaths) and net migration by decade.</p>
        </section>

        <section>
            <div class="full-bleed">
              <div class="viz-wrap">
                                    <!-- Map + Controls in flexible layout -->
                                    <div class="viz-grid">
                                        <!-- Main map area -->
                                        <div class="map-container">
                                            <svg id="map" width="1100" height="520" role="img" aria-label="World map"></svg>
                                        </div>
                  
                                        <!-- Control panel (legend, slider, search) -->
                                        <aside class="control-panel">
                                            <div class="control-section">
                                                <h3>Filter by peak status</h3>
                                                <div id="legend" class="legend" aria-label="Peak status legend"></div>
                                            </div>
                    
                                            <div class="control-section">
                                                <h3>Years after peak</h3>
                                                <div class="years-control">
                                                    <div class="slider-display">
                                                        <label for="yearsAfter">N = <span id="yearsAfterValue">25</span> years</label>
                                                    </div>
                                                    <input id="yearsAfter" type="range" min="10" max="30" step="5" value="25" />
                                                </div>
                                            </div>
                    
                                            <div class="control-section">
                                                <h3>Country search</h3>
                                                <div class="search-controls">
                                                    <input id="countrySearch" type="text" placeholder="Type country name..." />
                                                    <button id="clearSelection">Clear Selection</button>
                                                </div>
                                            </div>
                                            
                                            <div class="control-section">
                                                <h3>Selection summary</h3>
                                                <div id="summary" class="summary-card">
                                                    <div class="summary-placeholder">Select a country to see details</div>
                                                </div>
                                            </div>
                                        </aside>
                                    </div>

                                    <!-- OADR slopegraph and Components side-by-side -->
                                    <div class="charts-grid">
                                        <div class="chart-panel">
                                            <h3>Old-Age Dependency Ratio (OADR)</h3>
                                            <div id="oadrSummary" class="chart-summary" aria-live="polite" style="margin: 0.25rem 0 0.5rem; opacity: 0.85;"></div>
                                            <div id="oadrChart"></div>
                                            <div id="slopeLegend" class="mini-legend" style="margin-top: 0.5rem; font-size: 0.9rem; opacity: 0.85;"></div>
                                        </div>
                  
                                        <div class="chart-panel">
                                            <h3>Components of Change</h3>
                                            <div id="controls"></div>
                                            <div id="componentsChart"></div>
                                        </div>
                                    </div>
              </div>
            </div>
        </section>

        <section>
            <h2>Data &amp; methods</h2>
            <p><strong>Sources:</strong> UN World Population Prospects 2024, Standard Projections, Medium variant.</p>
            <ul>
                <li>Population by 5-year age groups (both sexes) → totals and OADR.</li>
                <li>Demographic indicators → births, deaths, net migration (decadal sums; per-1k are decade averages).</li>
            </ul>
            <p><strong>Definitions:</strong> OADR = Pop(65+) / Pop(15–64). "No peak" means no decline within the projection window—not "never."</p>
            <p><strong>Limits:</strong> Peak+N is capped at 2100; results reflect Medium-scenario assumptions about fertility, mortality, and migration.</p>
        </section>

        <section id="writeup" style="max-width:900px;margin:2rem 0 4rem;">
            <h2>Design Rationale</h2>

            <h3>Motivation</h3>
            <p>Population aging is uneven across the world. Policymakers and the public often focus on <em>if</em> and <em>when</em> populations peak, but the fiscal and social pressure is more tightly linked to how quickly the <strong>old‑age dependency ratio (OADR)</strong> rises after that peak. This project makes both timing and pace visible, side‑by‑side, and explains <em>why</em> trends differ using births, deaths, and migration.</p>

            <h3>Visual encodings &amp; interaction</h3>
            <p>The world map encodes four peak‑timing buckets (peaked, 2050, 2055+, no peak by 2100) with a categorical palette and doubles as the primary filter. The <em>slopegraph</em> compares OADR at the <em>peak year</em> versus <em>Peak + N</em> (user‑controlled), using dashed lines to distinguish countries without a peak by 2100. The <em>components</em> view is a compact waterfall that separates births (+), deaths (−), and net migration (±), with a mode toggle for decade totals (Absolute) versus normalized averages (Per 1k/yr). Multi‑select enables quick comparison (up to five), with small multiples in the components panel for readability.</p>

            <h3>Color palette &amp; accessibility</h3>
            <p>Peak‑status colors are chosen for contrast and color‑blind legibility: purple (peaked), green (2050), blue (2055+), and gray (no peak by 2100). Chart marks inherit <code>currentColor</code> so they remain readable in both light and dark themes. Labels, gridlines, and zero‑lines use subdued tints to reduce clutter while preserving contrast ratios. Focus and hover affordances are provided for keyboard and pointer users, and dynamic summaries are exposed via <code>aria-live</code>.</p>

            <h3>Data transformations</h3>
            <p>Peak year is the argmax of annual totals (WPP 2024, Medium). Countries are bucketed: &lt;2025 = peaked; 2025–2054 = 2050; ≥2055 = 2055+; maximum at 2100 = no peak (by 2100). OADR = Pop(65+)/Pop(15–64). Peak + N is capped at 2100. Components aggregate births, deaths, and net migration by decade; Per‑1k/yr uses decade‑average rates (component ÷ population × 1,000).</p>

            <h3>Alternatives considered</h3>
            <p>Cartograms and time‑series small multiples were prototyped but made scanning and search slower. Stacked areas showed long‑run trends but conflated adds and subtracts, so a waterfall layout was preferred for mechanism clarity.</p>

            <h2>Development Process</h2>
            <p><strong>Team:</strong> Solo project (team of one). <strong>Stack:</strong> D3.js on the client; data prepped with pandas; static CSVs for portability.</p>

            <ul>
                <li>Data acquisition &amp; cleaning (WPP 2024 Medium; country filtering)</li>
                <li>Metrics (peak buckets, OADR, decade components; edge‑case handling)</li>
                <li>D3 implementation (map projection, legend filters, search, selection)</li>
                <li>Slopegraph (slider, dashed no‑peak, tooltips, responsive labels)</li>
                <li>Components (absolute/per‑1k toggle, shared scales, small multiples)</li>
                <li>Integration, copy, accessibility, QA</li>
            </ul>

            <p><strong>Challenges &amp; lessons:</strong> Aligning WPP tables and handling “no peak by 2100”; keeping multi‑view interactions fast and readable; hardening theme support for both light and dark modes without conflicts.</p>
        </section>
    </main>

    <script type="module" src="../global.js"></script>
    <script type="module" src="project3.js"></script>
</body>
</html>
